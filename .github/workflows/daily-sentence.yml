name: Daily Inspiration Update

on:
  schedule:
    - cron: '0 0 * * *' # æ¯å¤©UTCæ—¶é—´00:00è¿è¡Œï¼ˆåŒ—äº¬æ—¶é—´8:00ï¼‰
  workflow_dispatch:    # å…è®¸æ‰‹åŠ¨è§¦å‘

jobs:
  update-readme:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4

    - name: Setup Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.x'
    
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install requests
        
    - name: Get daily sentence
      id: get-sentence
      run: |
        # ä¸‹è½½å¹¶è¿è¡ŒPythonè„šæœ¬è·å–æ•°æ®
        curl -o get_daily_sentence.py https://gist.githubusercontent.com/raw/... # æ›¿æ¢ä¸ºå®é™…è„šæœ¬URL
        
        python get_daily_sentence.py
        
        # ä»æ–‡ä»¶ä¸­è¯»å–æ•°æ®
        CONTENT=$(cat content.txt)
        NOTE=$(cat note.txt)
        TRANSLATION=$(cat translation.txt)
        PIC_URL=$(cat picture_url.txt)
        DATE=$(cat date.txt)
        
        # è®¾ç½®ç¯å¢ƒå˜é‡
        echo "CONTENT=$CONTENT" >> $GITHUB_ENV
        echo "NOTE=$NOTE" >> $GITHUB_ENV
        echo "TRANSLATION=$TRANSLATION" >> $GITHUB_ENV
        echo "PIC_URL=$PIC_URL" >> $GITHUB_ENV
        echo "DATE=$DATE" >> $GITHUB_ENV
        
    - name: Update README
      run: |
        # åˆ›å»ºPythonè„šæœ¬æ¥å®‰å…¨æ›´æ–°README
        cat > update_readme.py <<EOL
import re
import os

def read_file(filename):
    try:
        with open(filename, 'r') as f:
            return f.read()
    except:
        return ""

def write_file(filename, content):
    with open(filename, 'w') as f:
        f.write(content)

# è·å–ç¯å¢ƒå˜é‡
content = os.environ.get('CONTENT', '')
note = os.environ.get('NOTE', '')
translation = os.environ.get('TRANSLATION', '')
pic_url = os.environ.get('PIC_URL', '')
date = os.environ.get('DATE', '')

# è¯»å–åŸå§‹READMEå†…å®¹
readme_content = read_file('README.md')

# å®šä¹‰æ›¿æ¢æ¨¡æ¿
template = r'''
<div align="center" class="inspiration-card">
  <table>
    <tr>
      <td width="60%">
        <h3>ğŸ“œ æ¯æ—¥ä¸€è¯­</h3>
        <img src="https://img.shields.io/badge/è¯éœ¸æ¯æ—¥ä¸€å¥-DATE-blueviolet?style=flat-square" alt="æ—¥æœŸæ ‡è®°">
        <p><b>è‹±æ–‡ï¼š</b>CONTENT</p>
        <p><b>é‡Šä¹‰ï¼š</b>NOTE</p>
        <p><i>TRANSLATION</i></p>
      </td>
      <td width="40%">
        <img src="PIC_URL" width="300" alt="æ¯æ—¥é…å›¾">
      </td>
    </tr>
  </table>
</div>
'''

# æ›¿æ¢å˜é‡
template = template.replace('CONTENT', content)
template = template.replace('NOTE', note)
template = template.replace('TRANSLATION', translation)
template = template.replace('PIC_URL', pic_url)
template = template.replace('DATE', date)

# æŸ¥æ‰¾æ›¿æ¢åŒºåŸŸ
pattern = r'(<!-- BEGIN DAILY SENTENCE -->).*?(<!-- END DAILY SENTENCE -->)'
replacement = r'\1\n' + template + '\n\2'

# æ‰§è¡Œæ›¿æ¢
updated_content = re.sub(pattern, replacement, readme_content, flags=re.DOTALL)

# å†™å…¥æ›´æ–°åçš„å†…å®¹
write_file('README.md', updated_content)
EOL

        # è¿è¡Œè„šæœ¬
        python update_readme.py
        
    - name: Commit changes
      run: |
        git config --local user.email "41898282+github-actions[bot]@users.noreply.github.com"
        git config --local user.name "github-actions[bot]"
        git add README.md
        git commit -m "ğŸ“… è‡ªåŠ¨æ›´æ–°æ¯æ—¥é‡‘å¥ (${{ env.DATE }})"
        git push
